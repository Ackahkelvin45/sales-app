{% extends 'chrisco/layout.html'%}
{% load static %}
{%block body%}
<div class="w-full max-1xl:pl-[25%] max-md:pl-[33%] max-900px:pl-[28%]  pl-[20%] max-sm:pl-0  transform duration-500 mt-16 overflow-x-hidden " id="index-body">
    <div class="w-full  flex-col  items-center flex ">
        <div class="w-full h-52 bg-gradient-to-br from-green-500 to-slate-400 flex flex-col p-10 text-gray-100">
            <div class="w-full flex flex-row">
 <svg  version="1.0" xmlns="http://www.w3.org/2000/svg"  class="400px:h-[50px] 400px:w-[50px] w-[30px] h-[30px]" viewBox="0 0 64.000000 64.000000"  preserveAspectRatio="xMidYMid meet">  <g transform="translate(0.000000,64.000000) scale(0.100000,-0.100000)" fill="#f3f4fa" stroke="none"> <path d="M335 595 c-14 -13 -25 -33 -25 -44 0 -41 -25 -51 -126 -51 -56 0 -94 -4 -94 -10 0 -6 40 -10 100 -10 87 0 103 3 120 20 11 11 20 28 20 38 0 52 60 80 93 44 19 -21 22 -42 7 -42 -5 0 -10 -9 -10 -20 0 -11 -7 -20 -15 -20 -9 0 -15 -9 -15 -24 0 -17 -11 -31 -34 -46 -38 -23 -76 -90 -76 -133 l0 -28 -32 17 c-28 14 -35 15 -62 2 -18 -9 -47 -13 -68 -10 -25 3 -38 0 -38 -7 0 -8 -5 -9 -19 -1 -38 20 -41 13 -41 -90 0 -103 3 -110 41 -90 13 8 19 7 19 0 0 -7 14 -10 33 -9 26 3 43 -4 73 -29 l39 -32 159 2 c139 3 160 5 170 20 8 13 8 23 0 35 -9 15 -29 18 -119 21 -102 3 -111 4 -149 32 l-40 30 45 0 c25 0 62 -9 84 -20 52 -26 102 -25 155 3 51 27 90 90 90 145 0 51 -36 118 -76 142 -23 15 -34 29 -34 46 0 15 -6 24 -15 24 -8 0 -15 9 -15 20 0 11 -4 20 -10 20 -5 0 -10 7 -10 15 0 25 -47 65 -75 65 -14 0 -37 -11 -50 -25z m155 -125 c0 -5 -18 -10 -40 -10 -22 0 -40 5 -40 10 0 6 18 10 40 10 22 0 40 -4 40 -10z m31 -52 c41 -23 79 -84 79 -128 0 -48 -39 -108 -84 -129 -48 -24 -70 -26 -113 -11 -25 9 -29 15 -25 38 3 23 -2 31 -37 50 -48 27 -52 52 -21 117 38 78 126 105 201 63z m-228 -178 c90 -46 88 -60 -8 -60 -41 0 -75 -4 -75 -9 0 -5 24 -27 53 -49 l53 -41 109 -3 c90 -2 110 -6 110 -18 0 -13 -24 -15 -149 -18 l-148 -3 -49 38 -49 37 0 66 0 65 38 16 c20 10 39 16 42 15 3 -1 35 -17 73 -36z m-213 -60 c0 -49 -3 -61 -20 -70 -19 -10 -20 -8 -20 70 0 78 1 80 20 70 17 -9 20 -21 20 -70z m40 0 c0 -47 -4 -80 -10 -80 -6 0 -10 33 -10 80 0 47 4 80 10 80 6 0 10 -33 10 -80z"/> <path d="M433 387 c-7 -7 -19 -18 -28 -25 -32 -27 -6 -82 39 -82 13 0 29 -7 36 -15 19 -22 -5 -45 -46 -45 -19 0 -34 -4 -34 -10 0 -5 9 -10 19 -10 11 0 21 -6 23 -12 4 -10 9 -9 21 2 9 8 23 21 32 28 32 27 6 82 -39 82 -13 0 -29 7 -36 15 -19 22 5 45 46 45 19 0 34 5 34 10 0 6 -9 10 -20 10 -11 0 -20 5 -20 10 0 13 -12 12 -27 -3z"/> <path d="M16 572 c-3 -5 8 -21 23 -36 16 -15 31 -23 35 -18 3 5 -8 21 -23 36 -16 15 -31 23 -35 18z"/> <path d="M126 551 c-15 -16 -23 -31 -18 -35 5 -3 21 8 36 23 15 16 23 31 18 35 -5 3 -21 -8 -36 -23z"/> <path d="M36 441 c-15 -16 -23 -31 -18 -35 5 -3 21 8 36 23 15 16 23 31 18 35 -5 3 -21 -8 -36 -23z"/> <path d="M106 462 c-3 -5 8 -21 23 -36 16 -15 31 -23 35 -18 3 5 -8 21 -23 36 -16 15 -31 23 -35 18z"/> </g> </svg> 
            <span class="mx-2  mt-1  400px:text-3xl  text-lg ">Add Debt</span>
            
            </div>
            
        </div>
{%if edit %}
<form class="w-[95%]  bg-gray-100 z-10 -mt-14 rounded-md flex flex-col p-10 text-gray-600 mb-14"  method="POST" action="{% url 'debt:edit-debt-process' debt.id %}" id="myform"  enctype="multipart/form-data" >
{%else%}
<form class="w-[95%]  bg-gray-100 z-10 -mt-14 rounded-md flex flex-col p-10 text-gray-600 mb-14"  method="POST" action="{% url 'debt:add-debt-process'%}" id="myform"  enctype="multipart/form-data" >
{%endif%}
    
            <div  class="w-full flex flex-col"   >
                {% csrf_token %}
                <div class="flex flex-row w-full max-900px:flex-col">
                    <div class="flex flex-col w-full">
                        <span class="my-1"> Name of customer</span>
                        {{debtform.customer_name}}
                       
                    </div>

                    <div class="flex flex-col w-full">
                        <span class="my-1"> Total  Price</span>
                        <input class="h-12 rounded-md w-[95%]  border border-gray-400 focus:outline-none focus:ring-0 focus:border-gray-400 " type="number" placeholder="GH₵..."  id="total_price1" name="total_price"/>
                    

                    </div>
                </div>
                <div class="flex flex-row w-full max-900px:flex-col my-4">
                    <div class="flex flex-col w-full">
                        <span class="my-1">Paid price </span>
                        <input class="h-12 rounded-md w-[95%]  border border-gray-400 focus:outline-none focus:ring-0 focus:border-gray-400 " type="number" placeholder="GH₵..."  id="paid_price1" name="paid_price"/>
                     
                    </div>
                    <div class="flex flex-col w-full">
                        <span class="my-1">Due amount </span>
                        <div class="flex flex-row   "><span >GH₵ </span><span id="due_amount1" class="text-red-600 mx-1"></span></div>
                        <input  type="hidden"  id="due_amountform" name="due_amount"/>
                       
                      

                    </div>

                   
                </div>
                <div class="flex flex-row w-full max-900px:flex-col my-4">
                    
                    <div class="flex flex-col w-full">
                        <span class="my-1">Sales id </span>
                        <select class="h-12 rounded-md w-[95%] border border-gray-400 focus:outline-none focus:ring-0 focus:border-gray-400 search" name="serial_number">
                            <option value="----">-----</option>
                            {%for sale in sales%}
                            <option value="{{sale.serial_number}}">{{sale.serial_number}}</option>
                            {%endfor%}
                        </select>
                   
                    </div>
                    <div class="flex flex-col w-full"> 
                       
                      
                    </div>

                   
                </div>
                <div class="w-full flex flex-col my-10">
                    <span class="my-1">Notes</span>

    {{debtform.notes}}

                    </textarea>

                </div>
                <div class="w-full h-[1px] bg-gray-300 drop-shadow shadow-gray-400  "></div>
                <div class="w-full my-4">
                    <button class="text-gray-100 w-[12%] bg-green-600 text-xl py-3 px-2 rounded-md max-900px:w-[16%] max-sm:w-[28%] max-300px:w-[35%]"> save</button> 

                </div>

            </div>
 
      
        </div>

    </div>
</div>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!--
<script>

$(document).ready(function() {
    $('.search').select2({
    });
});

    var price=0
    var quanity=0
    var totalprice = 0
     var singletotal=0
  
    
    $(document).ready(function() {
        var  arrayofresults =[]
    $('#debt-select1').select2({

        multiple: true
    
    });
});

    $('#debt-select1').on('select2:select', function(e) {
        var option = e.params.data;
        $(option.element).attr('disabled', 'disabled');
        $('.debt-select1').trigger('change');
        price = parseFloat($(option.element).attr('data-price'))
        var name=$(option.element).attr('data-name')
        console.log("name",name);
console.log(price);
var products=[]
var product=""
{% for product in products %}

        products.push('{{product.name}}');
   
       
          {%endfor%}

          console.log(products);
          for (var i=0; i<products.length; i++){
            if (products[i]===name) {
                product=products[i];
            }
          }
console.log("product",product);

        Swal.fire({
          icon: 'question',
          title: "Quantity?",
          confirmButtonColor: 'rgb(22 163 74)',
          showConfirmButton:true,
       confirmButtonText:"Add",
       allowEscapeKey:false,
          background: '#727272',
          color:"white",
    html:"<div  class='w-full'>   <input class='h-12 rounded-md w-[95%]  border border-gray-400 focus:outline-none focus:ring-0 focus:border-gray-400 px-10 text-gray-600' type='number' id='quantity'  step=1/></div> ",
          
          showClass: {
            popup: 'my-icon'                     // disable popup animation css
          },
         
        }).then((result) => {
       
       if (result.isConfirmed){
          quantity= parseFloat(document.getElementById('quantity').value)

          console.log(quantity)
          singletotal=0
          singletotal=quantity*price
          console.log(singletotal)
          totalprice += singletotal
          console.log(totalprice)
          document.getElementById('total_price1').innerText=totalprice
          document.getElementById('total_priceform').value=totalprice

          $(option.element).attr('data-total', singletotal)
         
          var x = document.createElement("INPUT");
          var y = document.createElement("INPUT");
          x.setAttribute("type", "hidden");
          y.setAttribute("type", "hidden");
          x.setAttribute("value", quantity);
          x.setAttribute("name", "quantity"+name);
          y.setAttribute("name", "price"+name);
          y.setAttribute("value", singletotal);
          y.setAttribute("id", "price"+name);
          x.setAttribute("id", "quantity"+name);
          document.getElementById("myform").appendChild(x);
          document.getElementById("myform").appendChild(y); 

          var paid_price=document.getElementById('paid_price1').value;
        var  due_amount=totalprice-paid_price
        document.getElementById('due_amount1').innerText = due_amount;
        document.getElementById('due_amountform').value = due_amount;
        console.log(totalprice)
          

       } 
       else{
price=0
    quanity=0
    totalprice = 0
     singletotal=0
  
       }

      });

      $('#debt-select1').on('select2:unselect', function(e) {
        var option = e.params.data;
        $(option.element).removeAttr('disabled');
        $('.debt-select').trigger('change');
        $(option.element).attr('data-total')
        totalprice = totalprice - parseFloat($(option.element).attr('data-total'))
        if(isNaN(totalprice)){
            totalprice = 0
        }
        document.getElementById('total_price1').innerText=totalprice
        parseFloat($(option.element).attr('data-total'))
        $(option.element).attr('data-total', 0)
        console.log(parseFloat($(option.element).attr('data-total')))
     
        var name=$(option.element).attr('data-name')
    document.getElementById("price"+name).remove();
    document.getElementById("quantity"+name).remove();



    var paid_price=document.getElementById('paid_price1').value;
        var  due_amount=totalprice-paid_price
        document.getElementById('due_amount1').innerText = due_amount;
        document.getElementById('due_amountform').value = due_amount;
        console.log(totalprice)
      


    });
  

    });




    document.getElementById('paid_price1').addEventListener('keyup', ()=>{
        var paid_price=document.getElementById('paid_price1').value;
        var  due_amount=totalprice-paid_price
        document.getElementById('due_amount1').innerText = due_amount;
        document.getElementById('due_amountform').value = due_amount;
        console.log(totalprice)

    });

</script>
-->
<script>
   
   document.getElementById("paid_price1").addEventListener("keyup", ()=>{

    var  total_amount= document.getElementById("total_price1").value
   var paid_price = document.getElementById("paid_price1").value
   var  due_amount = total_amount - paid_price
   document.getElementById("due_amount1").innerText=due_amount
   document.getElementById("due_amountform").value=due_amount
   })
   $('.search').select2({})
</script>
        <style>
            .select2-selection__rendered {
        line-height: 40px !important;
    }
    .select2-container .select2-selection--single {
        height: 40px !important;
    }
    .select2-selection__arrow {
        height: 40px !important;

    }
 

        </style>
{%endblock%}